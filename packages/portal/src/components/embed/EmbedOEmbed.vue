<template>
  <AlertMessage
    v-if="$fetchState.error"
    :error="$fetchState.error"
  />
  <div
    v-else-if="!$fetchState.pending"
  >
    <EmbedHTML
      :html="html"
      :responsive="responsiveProvider"
      :height="height"
      :width="width"
    />
  </div>
</template>

<script>
  import oEmbed from '@/plugins/oembed';
  import AlertMessage from '../generic/AlertMessage';
  import EmbedHTML from './EmbedHTML';

  const RESPONSIVE_PROVIDERS = ['YouTube', 'Vimeo', 'Sketchfab'];

  export default {
    name: 'EmbedOEmbed',

    components: {
      AlertMessage,
      EmbedHTML
    },

    props: {
      url: {
        type: String,
        required: true
      },

      endpoint: {
        type: String,
        default: null
      }
    },

    data() {
      return {
        html: null,
        width: null,
        height: null,
        providerName: null
      };
    },

    async fetch() {
      const response = await oEmbed(this.url, this.endpoint);
      if (response.data?.html) {
        this.html = response.data.html;
        this.width = response.data.width;
        this.height = response.data.height;
        this.providerName = response.data['provider_name'];
      } else {
        throw new Error(this.$t('messages.externalContentError'));
      }
    },

    computed: {
      responsiveProvider() {
        return RESPONSIVE_PROVIDERS.includes(this.providerName);
      }
    }
  };
</script>
